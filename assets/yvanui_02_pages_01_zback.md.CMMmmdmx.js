import{_ as s,c as i,o as a,a6 as n}from"./chunks/framework.d-Ywx6yJ.js";const y=JSON.parse('{"title":"后台编码规范","description":"","frontmatter":{"title":"后台编码规范","date":"2024-03-29 22:02","author":"yvan"},"headers":[],"relativePath":"yvanui/02_pages/01_zback.md","filePath":"yvanui/02_pages/01_zback.md"}'),t={name:"yvanui/02_pages/01_zback.md"},l=n(`<h2 id="表名规范" tabindex="-1">表名规范 <a class="header-anchor" href="#表名规范" aria-label="Permalink to &quot;表名规范&quot;">​</a></h2><ul><li>bas_* 基础资料</li><li>doc_* 单据类</li><li>inv_* 库存类</li><li>sys_* 系统类</li><li>dev_* 开发辅助</li><li>rule_* 规则类</li><li>api_* 接口类</li><li>upload_* 上传类</li></ul><h2 id="设计原则" tabindex="-1">设计原则 <a class="header-anchor" href="#设计原则" aria-label="Permalink to &quot;设计原则&quot;">​</a></h2><ul><li><strong>用二开平台建表！统一数据结构和实体建设</strong></li><li><strong>表中必须有：创建(更新)时间 create_at / update_at 字段</strong></li><li><strong>表中必须有：创建(更新)人 create_by / update_by 字段</strong></li><li><strong>所有字符串类型字段必填(NotNull)，且使用 ‘N/A’ 做空值</strong></li><li><strong>每张表必须建立主键，主键尽量保持 bigint 类型</strong></li><li><strong>存储精确浮点数必须使用 Number(DECIMAL)→BigDecimal 替代 FLOAT 和 DOUBLE</strong></li><li><strong>库名、表名、字段名必须小写，下划线命名规范，不超过20个字符。Oracle有限制</strong></li><li><strong>建议使用 InnoDB 存储引擎。</strong></li><li><strong>禁用自增长( auto_increment ), 不允许任何表用自增长列，自增长会带来严重的数据同步问题</strong></li><li><strong>ID使用 bigint 类型，并且用雪花算法 ( <code>DAO.snowId()</code> ) 生成 long 类型的编号</strong></li><li><strong>将过大字段拆分到其他表中，大字段单独建表，一张表不超过1个大字段</strong></li><li>控制单表数据量，单表记录控制在千万级</li><li>控制列数量，字段数控制在30以内</li><li>平衡范式与冗余，为提高效率可以牺牲范式设计，冗余数据</li><li>前期不要拆库，保持一个库，不要自己做Hash分表，后期交给DBA来做。（尽量不分表，idx优于union、用搜索引擎优于数据库）</li><li>避免使用外键、触发器</li><li>表字符集选择UTF8</li><li>视图名以 vw_ 开头 / 索引名以 idx_ 开头</li><li>库名、表名、字段名见名知意,建议使用名词而不是动词。</li><li>字段名、表名必须有注释</li><li>存储时间（精确到秒）建议使用TIMESTAMP类型</li><li><strong>禁止在数据库中使用VARBINARY、BLOB存储图片、文件等</strong></li><li><strong>建议字段定义为NOT NULL。 空值是不占用空间的， not null的效率比null高</strong></li><li>避免使用NULL字段 / NULL字段很难查询优化 / NULL字段的索引需要额外空间 / NULL字段的复合索引无效</li><li>不在数据库里存图片、文件</li><li>务必请使用“同类型”进行比较，否则可能全表扫面</li><li>尽量不使用动态SQL，避免SQL注入，利于SQL缓存</li><li>SQL语句中IN包含的值不应过多</li><li>避免一条SQL超过6张表关联，减少left join使用</li><li><strong>WHERE条件中必须使用合适的类型，避免MySQL进行隐式类型转化，使用 javaType=long 在程序层面优化数据类型</strong></li><li>WHERE条件中的非等值条件（IN、BETWEEN、&lt;、&lt;=、&gt;、&gt;=）会导致后面的条件使用不了索引</li></ul><h2 id="索引类" tabindex="-1">索引类 <a class="header-anchor" href="#索引类" aria-label="Permalink to &quot;索引类&quot;">​</a></h2><ul><li>每张表必须有主键，主键建立聚簇索引，主键不应该被修改，字符串不应该做主键</li><li>谨慎合理使用索引</li><li>改善查询、减慢更新</li><li>索引一定不是越多越好（能不加就不加，要加的一定得加）</li><li>覆盖记录条数过多不适合建索引，例如“性别”</li><li>不在索引做列运算 bad case： select id where age +1 = 10;</li><li>不用外键，请由程序保证约束</li><li>非唯一索引必须按照“idx_字段名称_字段名称[_字段名]”进行命名</li><li>唯一索引必须按照“uniq_字段名称_字段名称[_字段名]”进行命名</li><li>索引名称必须使用小写</li><li>索引中的字段数建议不超过5个</li><li>单张表的索引数量控制在5个以内</li><li>唯一键由3个以下字段组成，并且字段都是整形时，使用唯一键作为主键</li><li>没有唯一键或者唯一键不符合5中的条件时，使用自增（或者通过发号器获取）id作为主键</li><li>唯一键不和主键重复</li><li>索引字段的顺序需要考虑字段值去重之后的个数，个数多的放在前面</li><li>ORDER BY，GROUP BY，DISTINCT的字段需要添加在索引的后面</li><li>UPDATE、DELETE语句需要根据WHERE条件添加索引</li><li>合理创建联合索引（避免冗余），(a,b,c) 相当于 (a) 、(a,b) 、(a,b,c)</li><li>合理利用覆盖索引</li></ul><h2 id="sql规范" tabindex="-1">SQL规范 <a class="header-anchor" href="#sql规范" aria-label="Permalink to &quot;SQL规范&quot;">​</a></h2><ul><li>SQL语句尽可能简单</li><li>一条sql只能在一个cpu运算，大语句拆小语句，减少锁时间，一条大sql可以堵死整个库</li><li>简单的事务, 事务时间尽可能短 bad case：上传图片事务</li><li>避免使用存储过程、触发器、函数</li><li>OR改写为IN()</li><li>OR改写为UNION</li><li>limit高效分页</li><li>使用union all替代union，union有去重开销</li><li>避免在SQL语句进行数学运算或者函数运算，容易将业务逻辑和DB耦合在一起</li><li>INSERT语句使用batch提交（INSERT INTO tableVALUES(),(),()……），values的个数不应过多</li><li>使用合理的SQL语句减少与数据库的交互次数</li><li>不使用ORDER BY RAND()，使用其他方法替换</li><li>建议使用合理的分页方式以提高分页的效率</li><li>统计表中记录数时避免使用COUNT(*)，是COUNT(primary_key)和COUNT(1)</li><li>不存在就插入、存在就只更新某几个字段，这类sql时，可以使用 INSERT INTO ... VALUES ... ON DUPLICATE ... 语句</li></ul><h1 id="后端编码规范" tabindex="-1">后端编码规范 <a class="header-anchor" href="#后端编码规范" aria-label="Permalink to &quot;后端编码规范&quot;">​</a></h1><p>后端编码既可以用 Java 语言，也可以使用 Groovy 语言。Java语言比较严谨，且编译速度较快。Groovy语言写法灵活，且可以<strong>及改既生效</strong>。</p><p>虽然项目是 SpringBoot 结构，且支持最传统的 SpringMVC 框架，然而在实际过程中，推荐使用静态方法完成业务开发，使用MVC规范可能会造成项目启动慢，且无法<strong>及改既生效</strong>，可能影响业务开发效率。</p><ul><li>前端传回的数据都是字符串类型，数据类型转换，使用 Conv.asLong / Conv.asDecimal / Conv.asBoolean 等，避免报错；</li></ul><h2 id="使用静态方法" tabindex="-1">使用静态方法 <a class="header-anchor" href="#使用静态方法" aria-label="Permalink to &quot;使用静态方法&quot;">​</a></h2><p>替代传统 SpringMVC 写法</p><ul><li>后端 groovy 方法</li></ul><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.galaxis.wms.bas</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> groovy.util.logging.Slf4j</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@Slf4j</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class Address {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    final static queryDsl= DaoFactory.getQueryDSL()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    final static dao= DaoFactory.getDao(Address.class)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    def static save(params) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        BasAddress address = new BasAddress()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        address.setAddrId(dao.snowId(&quot;bas_address&quot;))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        address.setParentId(DbConv.asLong(params.parent_id))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        address.setDivCode(DbConv.asString(params.div_code))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        address.setDivName(DbConv.asString(params.div_name))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        address.setDivType(DbConv.asString(params.div_type))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        address.setIsEnable(DbConv.asString(params.is_enable))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        long rowEffect = queryDsl.insert(QBasAddress.basAddress)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .populate(address)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                .execute()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        return Model.newSuccess(rowEffect)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><ul><li>前端 js 调用</li></ul><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">showLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">system.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">invokeServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/wms/bas/Address@save&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, res.data).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">res</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (res.success) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        system.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msg</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;更新成功&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        this</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.refs.addressGrid.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">finally</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    system.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">clearLoading</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>实际网络包</li></ul><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">POST</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">com</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">galaxis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wms</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">bas</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Address@save</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">	&quot;args&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">			&quot;parent_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">			&quot;div_code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">			&quot;div_name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">			&quot;div_type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;C&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">			&quot;is_enable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0001&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="返回值使用-model-t-包裹" tabindex="-1">返回值使用 Model[T] 包裹 <a class="header-anchor" href="#返回值使用-model-t-包裹" aria-label="Permalink to &quot;返回值使用 Model[T] 包裹&quot;">​</a></h2><ul><li>业务异常返回示例</li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Model</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Integer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveModuleToFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String, Object</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> params) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	String resourceUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Conv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(params.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;resourceUrl&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Strings.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isNullOrEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(resourceUrl)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newFail</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;写入模块，必须包含 resourceUrl 内容&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>业务异常返回示例(Groovy)</li></ul><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> saveModuleToFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> resourceUrl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Conv.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asString(params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resourceUrl);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Strings.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isNullOrEmpty(resourceUrl)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Model.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newFail(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;写入模块，必须包含 resourceUrl 内容&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	..</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>更新，返回示例</li></ul><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rowEffected </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 更改数据，使用 QueryDSL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rowEffected </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">update(sysResource)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .set(sysResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resourceType, resourceType)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .where(sysResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resourceId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(resourceId))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .where(sysResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sysApp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(sysApp))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .execute();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ModelOps.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newSuccess(rowEffected);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>批量更新，返回示例</li></ul><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 批量更新，执行性能是单个执行的10倍以上</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SQLUpdateClause</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batchUpdate </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">update(sysResource);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// for 循环中增加批量作业</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	batchUpdate</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		.set(sysResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resourceParentId, key)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		.set(sysResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resourceSort, resourceSort)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		.where(sysResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sysApp</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(app_key))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		.where(sysResource</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">resourceId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(resourceId))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		.addBatch();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rowEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (batchUpdate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getBatchCount() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 批量作业数 &gt; 0 批量执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rowEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> batchUpdate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">execute();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ModelOps.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newSuccess(rowEffect);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>返回表单示例</li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.yvan.core.YvanUtil;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Map&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; row </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Maps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newLinkedHashMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">row.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sysAppRow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sysAppRow);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">row.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;resourceRow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, resourceRow,);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">row.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;moduleContent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(row);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 或者</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(YvanUtil.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">buildMap</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;sysAppRow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, sysAppRow,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;resourceRow&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, resourceRow,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &quot;moduleContent&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, content,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>查询数据，返回示例</li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SysRuleFact</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> querydsl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Projections.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                SysRuleFact.class,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                sysRuleFact.factCode,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                sysRuleFact.factName,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                sysRuleFact.factFieldsJson</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sysRuleFact)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">orderBy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sysRuleFact.factCode.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Model.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(list);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>查询数据，分页查询，并分页返回示例(groovy)</li></ul><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 mybatis</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mybatis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DaoFactory.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getMyBatis(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Widget.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sqlId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;queryItem&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> list </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> mybatis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queryByPage(sqlId, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">YvanExt.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getQueryByPage(), params)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Model.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newSuccess(list)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 使用 jdbc</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jdbc </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DaoFactory.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getJdbc();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sql </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;select * from table1 where f1=#{f1} and f2=#{f2}&quot;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IPage&lt;Map&lt;String, Object&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> page </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jdbc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queryByPage(sql , </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">YvanExt.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getQueryByPage(), [</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  f1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">11</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  f2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;bb&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ModelOps.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newSuccess(page)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h2 id="使用-querydsl-完成数据更新" tabindex="-1">使用 QueryDSL 完成数据更新 <a class="header-anchor" href="#使用-querydsl-完成数据更新" aria-label="Permalink to &quot;使用 QueryDSL 完成数据更新&quot;">​</a></h2><div class="language-jsx vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">long rowEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">//处理质检状态</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rowEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems.inspectStatus,CInInspectStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IN_INSPECT_OVER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.inspectId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inspectId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.inspectLineNo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lineList) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.inspectStatus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CInInspectStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IN_INSPECT_OVER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.qty.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems.rejectQty.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems.inspectQty))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rowEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems.inspectStatus,CInInspectStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IN_INSPECT_BE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.inspectId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inspectId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.inspectLineNo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(lineList) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.inspectStatus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CInInspectStatus.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">IN_INSPECT_BE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.rejectQty.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BigDecimal.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ZERO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        docInspectItems.inspectQty.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">gt</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BigDecimal.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ZERO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	      )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String minInspectStatus </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems.inspectStatus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">min</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspectItems.inspectId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inspectId))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetchFirst</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rowEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspect)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docInspect.inspectStatus,minInspectStatus)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		        docInspect.inspectId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inspectId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		        docInspect.inspectStatus.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ne</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(minInspectStatus)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 批量更新</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SQLUpdateClause updateAsnItems </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docAsnItems)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Map.Entry</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String,List</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LinkedHashMap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">String, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?&gt;&gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> entry </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> asnLineGroup.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">entrySet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    BigDecimal rejectQty </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DbConv.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asDecimal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(entry.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({a -&gt; a.reject_qty}))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    updateAsnItems</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">				    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docAsnItems.inspectQty,docAsnItems.inspectQty.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(inspectQty))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docAsnItems.inspectRejectQty,docAsnItems.inspectRejectQty.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rejectQty))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(docAsnItems.asnId.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(asnId) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> docAsnItems.asnLineNo.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">eq</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(asnLineNo))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addBatch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (updateAsnItems.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBatchCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">		// 批量作业数 &gt; 0 批量执行</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    rowEffect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> updateAsnItems.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ModelOps.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newSuccess</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(rowEffect)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h2 id="使用-querydsl-完成简单数据查询" tabindex="-1">使用 QueryDSL 完成简单数据查询 <a class="header-anchor" href="#使用-querydsl-完成简单数据查询" aria-label="Permalink to &quot;使用 QueryDSL 完成简单数据查询&quot;">​</a></h2><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">package</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> com.galaxis.wms.inbound</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@Slf4j</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ReceiptCheck</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> queryReceiptItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    Long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receiptId </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Conv.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asLong(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BaseAssert.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">checkParam(params, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;receipt_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;收货单ID不能为空&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    Integer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receiptLineNo </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Conv.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asInteger(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BaseAssert.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">checkParam(params, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;receipt_line_no&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;收货单明细行号不能为空&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receiptItems </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .select(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	            [</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QBasItem.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basItem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">itemCode,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QBasItem.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basItem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">itemName,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QBasItem.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basItem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">itemSpecification,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">qty</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subtract(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiptQty)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subtract(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rejectedQty)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">as(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;unreceipt_qty&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiptQty</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subtract(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inspectedQty)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">subtract(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">inspectRejectedQty)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">as(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;uninspected_qty&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QBasPackageItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basPackageItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">packUnit,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	                QBasPackageItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basPackageItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">packMeas</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	            ]</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">linkedMap())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .from(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .leftJoin(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">on(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asnId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asnId) &amp; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocAsnItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docAsnItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asnLineNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asnLineNo))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .leftJoin(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QBasItem.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basItem)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">on(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QBasItem.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basItem</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">itemId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">itemId))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .leftJoin(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QBasPackageItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basPackageItems)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">on(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QBasPackageItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basPackageItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">packId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">packageId) &amp; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QBasPackageItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">basPackageItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">packLevel</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CPackLevel.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">BASE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .where(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiptId</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(receiptId))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .where(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">QDocReceiptItems.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">docReceiptItems</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">receiptLineNo</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">eq(receiptLineNo))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	        .fetch();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    BaseAssert.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">isEmpty(receiptItems, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;没有该条明细&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receiptItem </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> receiptItems[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	    return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Model.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newSuccess([</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">receiptItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: receiptItem]);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="使用-mybatis-完成复杂数据查询" tabindex="-1">使用 MyBatis 完成复杂数据查询 <a class="header-anchor" href="#使用-mybatis-完成复杂数据查询" aria-label="Permalink to &quot;使用 MyBatis 完成复杂数据查询&quot;">​</a></h2><ul><li>使用静态成员变量，拿到当前类的 MyBatis 实例</li><li>在当前类的所在位置，建立同名 xml 文件作为 Mybatis 内容</li><li>比如有一个 groovy 类，名称为 Device.groovy:</li></ul><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Device</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> queryDsl </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DaoFactory.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getQueryDSL()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myBatis </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DaoFactory.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getMyBatis(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Device.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">class)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> loadFromDb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">wh_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DbConv.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">asLong(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WhIdHolder.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getWhId())</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageOfList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myBatis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queryByPage(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deviceGridQueryData&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">YvanExt.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getQueryByPage(), params)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Model.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newSuccess(pageOfList)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>在同一路径下建立 Device.xml</li></ul><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;?</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">xml</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> version</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1.0&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> encoding</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;UTF-8&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">mapper</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> namespace</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">select</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deviceGridQueryData&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	select </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">		device.*,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	    bw.wh_name</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	from bas_device device</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	left join bas_wh bw on bw.wh_id = device.wh_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	-- where device,bw</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	order by device.device_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">select</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deviceRelGridQueryData&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	select t.*, bl.loc_code, bl.device_pos from bas_device_location_rel t </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	left join bas_location bl on bl.loc_id = t.loc_id</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	where t.device_id = #{device_id}::numeric</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">	&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">mapper</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>使用 DaoFactory.getMyBatis(Device.class) 即可完成对应 xml 文件的查询操作</li><li>queryByPage 方法，完成分页的读取</li></ul><div class="language-groovy vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pageOfList </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> myBatis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">queryByPage(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;deviceGridQueryData&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">YvanExt.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">getQueryByPage(), params)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> Model.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">newSuccess(pageOfList)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="专业名词统一" tabindex="-1">专业名词统一 <a class="header-anchor" href="#专业名词统一" aria-label="Permalink to &quot;专业名词统一&quot;">​</a></h2><table><thead><tr><th>中文</th><th>英文</th><th>简写</th></tr></thead><tbody><tr><td>仓库</td><td>warehouse,</td><td>wh</td></tr><tr><td>采购</td><td>purchase</td><td></td></tr><tr><td>上架</td><td>putaway</td><td></td></tr><tr><td>质检</td><td>inspection</td><td></td></tr><tr><td>收货</td><td>receipt</td><td></td></tr><tr><td>补货</td><td>replenishment,</td><td>rep</td></tr><tr><td>销售</td><td>sale</td><td></td></tr><tr><td>波次</td><td>wave</td><td></td></tr><tr><td>拣货</td><td>picking/picker</td><td>pick</td></tr><tr><td>盘点</td><td>stock_taking</td><td>check</td></tr><tr><td>发货</td><td>shipment</td><td></td></tr><tr><td>装车</td><td>loading</td><td></td></tr><tr><td>冲红</td><td>inverse</td><td></td></tr><tr><td>移库</td><td>transfer</td><td></td></tr><tr><td>交接</td><td>delivert</td><td></td></tr><tr><td>最小库存单元</td><td>sku</td><td></td></tr><tr><td>批次</td><td>lot</td><td></td></tr><tr><td>数量</td><td>qty</td><td></td></tr><tr><td>包装</td><td>pack</td><td></td></tr><tr><td>打包</td><td>packaging</td><td></td></tr><tr><td>打包台</td><td>packaging-table</td><td></td></tr><tr><td>零散</td><td>unpacked</td><td></td></tr><tr><td>拆零</td><td>unpacking</td><td></td></tr><tr><td>商品</td><td>item</td><td></td></tr><tr><td>客户</td><td>customer</td><td></td></tr><tr><td>指令</td><td>command</td><td>cmd</td></tr><tr><td>容量</td><td>capacity</td><td></td></tr><tr><td>容器</td><td>container</td><td></td></tr><tr><td>容器编号</td><td>LPN</td><td></td></tr><tr><td>账页流水</td><td>ledger</td><td></td></tr><tr><td>职员</td><td>staff</td><td></td></tr><tr><td>库存</td><td>inventory,</td><td>inv</td></tr><tr><td>极限</td><td>limit</td><td></td></tr><tr><td>规则</td><td>rule</td><td></td></tr><tr><td>限制</td><td>restrict</td><td></td></tr><tr><td>库房</td><td>room</td><td></td></tr><tr><td>区域</td><td>zone</td><td></td></tr><tr><td>货位</td><td>location</td><td></td></tr><tr><td>货位组</td><td>location-group</td><td></td></tr><tr><td>物料</td><td>material</td><td></td></tr><tr><td>堆垛机</td><td>stacker</td><td></td></tr><tr><td>版本</td><td>model</td><td></td></tr><tr><td>复核</td><td>review</td><td></td></tr><tr><td>内复核</td><td>InReview</td><td></td></tr><tr><td>外复核</td><td>OutReview</td><td></td></tr><tr><td>装箱复核</td><td>packReview</td><td></td></tr><tr><td>装车复核</td><td>loadReview</td><td></td></tr><tr><td>暂存区</td><td>stage/staging</td><td></td></tr><tr><td>合并</td><td>combined</td><td></td></tr><tr><td>工位</td><td>position</td><td></td></tr><tr><td>提货</td><td>pickup</td><td></td></tr><tr><td>站台</td><td>platform</td><td></td></tr><tr><td>批准文号</td><td>approval</td><td></td></tr><tr><td>权限</td><td>permission</td><td></td></tr><tr><td>策略</td><td>strategy</td><td></td></tr><tr><td>码盘（堆垛）</td><td>palletize</td><td></td></tr><tr><td>归档</td><td>archive</td><td></td></tr><tr><td>调整</td><td>adjust</td><td></td></tr><tr><td>锁定（任何情况下不能动）</td><td>lock</td><td></td></tr><tr><td>冻结（调度不可见）</td><td>freeze</td><td></td></tr><tr><td>层</td><td>floor</td><td></td></tr><tr><td>设备</td><td>device</td><td></td></tr><tr><td>环境</td><td>environment,</td><td>env</td></tr><tr><td>结算</td><td>settlement</td><td></td></tr><tr><td>误差</td><td>deviation</td><td></td></tr><tr><td>条码</td><td>barcode</td><td></td></tr><tr><td>方向</td><td>direction</td><td></td></tr><tr><td>路线</td><td>route</td><td></td></tr><tr><td>地址</td><td>address</td><td></td></tr><tr><td>条件</td><td>condition</td><td></td></tr><tr><td>表达式</td><td>expressions,</td><td>expr</td></tr><tr><td>身份号</td><td>id</td><td></td></tr><tr><td>编码</td><td>code</td><td></td></tr><tr><td>创建人</td><td>create_by</td><td></td></tr><tr><td>创建时间</td><td>create_at</td><td></td></tr><tr><td>更新人</td><td>update_by</td><td></td></tr><tr><td>更新时间</td><td>update_at</td><td></td></tr><tr><td>占用</td><td>occupancy</td><td></td></tr><tr><td>剩余</td><td>remain</td><td></td></tr><tr><td>结存</td><td>balance</td><td></td></tr><tr><td>入库</td><td>Inbound</td><td></td></tr><tr><td>出库</td><td>Outbound</td><td></td></tr><tr><td>供应商</td><td>supplier</td><td></td></tr><tr><td>分播</td><td>sowing,</td><td>sow</td></tr><tr><td>出库滑道</td><td>exit_slide</td><td></td></tr><tr><td>交接</td><td>handover</td><td></td></tr><tr><td>传输线</td><td>conveyor</td><td></td></tr><tr><td>电梯</td><td>elevator</td><td></td></tr><tr><td>人力</td><td>manpower</td><td></td></tr><tr><td>搬运</td><td>carry</td><td></td></tr><tr><td>退货</td><td>refund</td><td></td></tr><tr><td>生产</td><td>produce</td><td></td></tr><tr><td>退料</td><td>return</td><td>material</td></tr><tr><td>称量</td><td>metage</td><td></td></tr><tr><td>破损、损坏</td><td>damaged</td><td></td></tr><tr><td>回收</td><td>recovery</td><td></td></tr><tr><td>机械手</td><td>machanical</td><td>arm,</td></tr><tr><td>月台</td><td>platform</td><td></td></tr><tr><td>门洞</td><td>door</td><td></td></tr><tr><td>滑道</td><td>slide</td><td></td></tr><tr><td>托盘</td><td>Pallet</td><td></td></tr><tr><td>周转箱</td><td>turnover</td><td>box</td></tr><tr><td>托盘立体库站台</td><td>pallet</td><td>station</td></tr><tr><td>内复核站台</td><td>review</td><td>station</td></tr><tr><td>分播站台</td><td>sow</td><td>station</td></tr><tr><td>箱库拣选站台</td><td>box</td><td>station</td></tr><tr><td>分播位</td><td>sow</td><td>position</td></tr><tr><td>播种拣选</td><td>batch</td><td>picking</td></tr><tr><td>摘果拣选</td><td>discreet</td><td>picking</td></tr><tr><td>货到人拣货</td><td>auto</td><td>arrival,pick</td></tr><tr><td>纸单拣货</td><td>paper</td><td>pick</td></tr><tr><td>电子标签拣货</td><td>digital</td><td>pick</td></tr><tr><td>小车拣货</td><td>hand</td><td>truck</td></tr><tr><td>订单箱</td><td>order</td><td>box</td></tr><tr><td>库存箱</td><td>stock</td><td>box</td></tr><tr><td>在途</td><td>transit</td><td></td></tr><tr><td>转运</td><td>transfer</td><td></td></tr><tr><td>码垛</td><td>palletizing</td><td></td></tr><tr><td>拆垛</td><td>depalletizing</td><td></td></tr><tr><td>输送线</td><td>conveyor</td><td></td></tr><tr><td>注册容器条码</td><td>LPN</td><td></td></tr><tr><td>自动化</td><td>automatic</td><td></td></tr><tr><td>冷藏</td><td>chill</td><td></td></tr><tr><td>冷冻</td><td>freeze</td><td></td></tr><tr><td>货架</td><td>rack</td><td></td></tr><tr><td>零售</td><td>retail</td><td></td></tr><tr><td>整件</td><td>whole</td><td></td></tr><tr><td>理货</td><td>tally</td><td></td></tr><tr><td>拼箱</td><td>less</td><td>LCL</td></tr><tr><td>整箱</td><td>full</td><td>FCL</td></tr><tr><td>尾箱</td><td>tail</td><td>box</td></tr><tr><td>集货</td><td>goods</td><td>collection</td></tr><tr><td>装车</td><td>load</td><td></td></tr><tr><td>调拨</td><td>interstore</td><td></td></tr></tbody></table><p>11</p>`,49),p=[l];function e(h,k,r,d,E,g){return a(),i("div",null,p)}const o=s(t,[["render",e]]);export{y as __pageData,o as default};
